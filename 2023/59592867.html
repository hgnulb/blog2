<!DOCTYPE html>

<!--[if lt IE 7]>
<html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en">
<![endif]-->
<!--[if IE 7]>
<html class="no-js lt-ie9 lt-ie8" lang="en">
<![endif]-->
<!--[if IE 8]>
<html class="no-js lt-ie9" lang="en">
<![endif]-->
<!--[if gt IE 8]><!-->
<html class="no-js" lang="en">
<!--<![endif]-->

<head>
    <meta charset="utf-8">
<!--[if IE]>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<![endif]-->
<meta content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no" name="viewport">
<meta content="HGNULB,Java 并发" name="keywords"/>

<!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Java 多线程-经典编程题 | 走在修行的大街上</title>
<meta name="generator" content="Jekyll v4.3.4" />
<meta property="og:title" content="Java 多线程-经典编程题" />
<meta name="author" content="HGNULB" />
<meta property="og:locale" content="en" />
<meta name="description" content="小兵的 BLOG" />
<meta property="og:description" content="小兵的 BLOG" />
<link rel="canonical" href="https://hgnulb.github.io/blog/2023/59592867" />
<meta property="og:url" content="https://hgnulb.github.io/blog/2023/59592867" />
<meta property="og:site_name" content="走在修行的大街上" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2023-08-15T03:04:39+08:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Java 多线程-经典编程题" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"HGNULB"},"dateModified":"2023-08-15T03:04:39+08:00","datePublished":"2023-08-15T03:04:39+08:00","description":"小兵的 BLOG","headline":"Java 多线程-经典编程题","mainEntityOfPage":{"@type":"WebPage","@id":"https://hgnulb.github.io/blog/2023/59592867"},"url":"https://hgnulb.github.io/blog/2023/59592867"}</script>
<!-- End Jekyll SEO tag -->


<link href="https://cdn.jsdelivr.net/gh/hgnulb/blog@gh-pages/assets/images/theme/favicon.svg" rel="shortcut icon" type="image/x-icon">
<link href="https://cdn.jsdelivr.net/gh/hgnulb/blog@gh-pages/assets/images/theme/favicon.svg" rel="icon" type="image/x-icon">
    <link href='/blog/assets/libs/stylesheets/blog.css' rel="stylesheet" type="text/css">
    <title>Java 多线程-经典编程题</title>
    
<!--jquery插件-->
<script src="https://cdn.jsdelivr.net/npm/jquery/dist/jquery.min.js"></script>
<!--字体图标-->
<link href="https://cdn.jsdelivr.net/gh/hgnulb/blog@gh-pages/assets/libs/fontawesome/css/all.min.css" rel="stylesheet">
<!--Tippy.js插件-->
<link href="https://cdn.jsdelivr.net/npm/tippy.js/animations/shift-away.min.css" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/tippy.js/themes/translucent.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core/dist/umd/popper.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/tippy.js/dist/tippy-bundle.umd.js"></script>
<!--其他插件-->
<script src="https://cdn.jsdelivr.net/npm/npm-modernizr/modernizr.min.js"></script>
<!--顶部进度条-->
<script src="https://cdn.jsdelivr.net/npm/pace-js@latest/pace.min.js"></script>


<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

<script>
    if (window.location.pathname === '/blog') {
        window.location.replace('/blog/');
    }

    function getPropertyValue(propertyName) {
        let style = window.getComputedStyle(document.documentElement);
        return style.getPropertyValue(propertyName);
    }

    const setProperty = (propertyName, propertyValue) => {
        document.documentElement.style.setProperty(propertyName, propertyValue);
    };

    function typedEntryTitle() {
        window.addEventListener("DOMContentLoaded", function () {
            let entryTitle = document.querySelector(".entry-title");
            let pageTitle = "Java 多线程-经典编程题";
            let index = 0;

            function typedTitle() {
                if (index <= pageTitle.length) {
                    entryTitle.innerText = `${pageTitle.slice(0, index++)}|`;
                    setTimeout(typedTitle, 100);
                } else {
                    entryTitle.innerText = pageTitle;
                }
            }

            typedTitle();
        });
    }

    function changePoint(url, id) {
        let target = document.getElementById(id.replace("#", ""));
        if (null === target || target === undefined) {
            document.location.href = url;
        } else {
            target.scrollIntoView(true);
        }
        sessionStorage.setItem("location", id.replace("#", ""));
    }

    const imgError = image => {
        image.onerror = null;
        if ("true" === "true") {
            image.src = `https://cdn.jsdelivr.net/gh/hgnulb/blog@gh-pages/assets/images/theme/err-img.svg`;
        } else {
            image.src = `/blog/assets/images/theme/err-img.svg`;
        }
        $(image).css("width", "100px");
        return true;
    };

    function tippyConfigure() {
        tippy("[data-tippy-content]", {
            theme: "translucent",
            animation: "shift-away",
            inertia: true,
            allowHTML: true
        });
    }

    function initContents() {
        let markdownToc = $("#markdown-toc");
        if (markdownToc.length) {
            $("#sidebar-toc-content").append(markdownToc.html());
            let toc = $("#markdown-toc, #sidebar-toc-content").find("a");
            if (toc.length) {
                toc.each(function () {
                    let id = $(this).attr("href");
                    $(this).attr("data-tippy-content", $(this).html());
                    $(this).on("click", function (e) {
                        e.preventDefault();
                        changePoint(id, id);
                    });
                });
            }
        }
    }

    function generateContents() {
        let markdownToc = $("#markdown-toc");
        if (markdownToc.length) {
            if ($(window).width() >= 1366) {
                markdownToc.css("display", "none");
                $("#page").css("margin-left", getPropertyValue("--sidebar-width"));
                $(".sidebar").css("display", "block");
                $(".nav-global .btn-contents").removeClass("hidden");
            } else {
                markdownToc.css("display", "inline-block");
                $(".sidebar").css("display", "none");
                $(".nav-global .btn-contents").addClass("hidden");
                $("#page").css("margin-left", "0px");
            }
        }
    }

    function contentsToggle() {
        initContents();
        generateContents();
        $(window).resize(generateContents);
        $(".nav-global .btn-contents").on("click", function () {
            let click = $(this).data("clicks");
            if (click) {
                $(this).find("i").removeClass("fa-arrow-right-long").addClass("fa-arrow-left-long");
                $(".sidebar").css("display", "block");
                $("#page").css("margin-left", getPropertyValue("--sidebar-width"));
            } else {
                $(this).find("i").removeClass("fa-arrow-left-long").addClass("fa-arrow-right-long");
                $(".sidebar").css("display", "none");
                $("#page").css("margin-left", "0px");
            }
            $(this).data("clicks", !click);
        });
    }

    function themeToggle() {
        let themeMode = $(".theme-mode");
        if (localStorage.toggled === "light") {
            document.documentElement.classList.add("light");
            themeMode.find("i").removeClass("fa-toggle-off").addClass("fa-toggle-on");
        } else {
            document.documentElement.classList.remove("light");
            themeMode.find("i").removeClass("fa-toggle-on").addClass("fa-toggle-off");
        }
        themeMode.on("click", function () {
            document.documentElement.classList.toggle("light");
            if (localStorage.toggled !== "light") {
                localStorage.toggled = "light";
                $(this).find("i").removeClass("fa-toggle-off").addClass("fa-toggle-on");
            } else {
                localStorage.toggled = "dark";
                themeMode.find("i").removeClass("fa-toggle-on").addClass("fa-toggle-off");
            }
        });
    }

    function jumpLocation() {
        let location = sessionStorage.getItem("location");
        sessionStorage.removeItem("location");
        if (location == null) {
            return;
        }
        let target = document.getElementById(location);
        if (target != null) {
            target.scrollIntoView(true);
        }
    }

    window.onload = function () {
        jumpLocation();
    };

    $(function () {
        themeToggle();
        contentsToggle();
        tippyConfigure();
    });
</script>

</head>

<body>
<canvas id="universe"></canvas>
<!--[if IE]>
<p class="site-notice">您正在使用一个过时的网页浏览器。<a href="https://browsehappy.com/" target="_blank">请升级您的浏览器。</a></p>
<![endif]-->
<noscript>
    <p class="site-notice">本网站需要 JavaScript。<a href="https://www.enable-javascript.com/" target="_blank">请查阅指南来给您的浏览器开启 JavaScript 功能。</a></p>
</noscript>

<div class="nav-wrapper overlay-wrapper">
    <div class="nav-form overlay-form">
        <span class="overlay-header menu">Menu</span>
        <a class="btn-close"><i class="fas fa-times"></i></a>
        <div class="results">
            <ul>
                <li><a href="/blog/categories/"><i class="fa-solid fa-bookmark"></i> Categories</a></li>
                <li><a href="/blog/categories/sort/"><i class="fa-regular fa-bookmark"></i> Categories</a></li>
                <li><a href="/blog/tags/"><i class="fa-solid fa-lemon"></i> Tags</a></li>
                <li><a href="/blog/tags/sort/"><i class="fa-regular fa-lemon"></i> Tags</a></li>
                <li><a href="/blog/home/">About</a></li>
            </ul>
        </div>
    </div>
</div>

<div class="search-wrapper overlay-wrapper">
    <div class="search-form overlay-form animate__animated animate__bounce">
        <label><input class="overlay-header" id="search-input" placeholder="please enter keyword search" tabindex="-1" type="text"></label>
        <a class="btn-close"><i class="fas fa-times"></i></a>
        <ul id="results-container"></ul>
    </div>
</div>
<div class="sidebar animate__animated animate__bounceInLeft">
    <div class="sidebar-toc">
        <div class="sidebar-toc-title">Table of contents</div>
        <ul id="sidebar-toc-content"></ul>
    </div>
</div>
<div id="page">
    <header class="the-header">
    <div class="unit-head">
        <nav class="nav-global animate__animated animate__headShake">
            <ul>
                <li class="logo">
                    <button class="btn-menu" data-tippy-content="Menu"><i class="fas fa-bars"></i></button>
                    <a href="/blog/home/">走在修行的大街上</a>
                    <!--[if !IE]>-->
                    <button class="btn-search" data-tippy-content="Search"><i class="fas fa-search"></i></button>
                    <!--<![endif]-->
                </li>
                <li><a class="theme-mode"><i class="fa-solid fa-toggle-off"></i></a></li>
                <li><a class="btn-contents hidden"><i class="fa-solid fa-arrow-left-long"></i></a></li>
                <li><a href="/blog/categories/"><i class="fa-solid fa-bookmark"></i></a></li>
                <li><a href="/blog/categories/sort/"><i class="fa-regular fa-bookmark"></i></a></li>
                <li><a href="/blog/tags/"><i class="fa-solid fa-lemon"></i></a></li>
                <li><a href="/blog/tags/sort/"><i class="fa-regular fa-lemon"></i></a></li>
                <!--[if !IE]>-->
                <li><a class="btn-search"><i class="fa-solid fa-magnifying-glass"></i></a></li>
                <!--<![endif]-->
            </ul>
        </nav>
    </div>
</header>
    <div class="body animate__animated animate__bounceInLeft" role="main">
        <div class="unit-body">
            <div class="unit-inner">

                <!--page start-->
                <article class="unit-article layout-post">
    <div class="unit-inner unit-article-inner">
        <div class="content">
            <header>
                <div class="unit-head">
                    <div class="unit-inner">
                        <h1 class="entry-title">Java 多线程-经典编程题</h1>
                    </div>
                </div>
            </header>
            <div class="meta">
                <section class="date-publish">
                    <button>
                        <i class="fas fa-calendar-alt article-icon"></i>Published:
                        <time class="date-pub updated"
                              data-tippy-content="2023-08-15 03:04:39" datetime="2023-08-15T03:04:39+08:00">2023-08-15
                        </time>
                        by
                        <a class="author" href="/blog/" rel="author">
                            HGNULB
                        </a>
                    </button>
                    
                </section>
                
                <ul class="list-category list-linear">
                    <li class="list-head"><i class="fas fa-inbox article-icon"></i>Categories:</li>
                    
                    <categories id="categories-sort" class="hidden">
    

    
    
    

    
    

    <div>
        
            <a onclick="changePoint('/blog/categories/', '#Java-并发')" data-tippy-content="Java 并发">
                <button>Java 并发&nbsp;<span>0 / 1</span></button>
            </a>
        
    </div>
</categories>
                    <categories id="categories-main" class="hidden">
    

    
    
    

    
    

    <div>
        
            <a onclick="changePoint('/blog/categories/', '#Java-并发')" data-tippy-content="Java 并发">
                <button>Java 并发&nbsp;<span>0 / 1</span></button>
            </a>
        
    </div>
</categories>
                </ul>
                
                
                <ul class="list-tag list-linear">
                    <li class="list-head"><i class="fas fa-tag article-icon"></i>Tags:</li>
                    
                    


                    <tags id="tags-sort" class="hidden">
    

    
    
    

    
    

    <div>
        
            <a onclick="changePoint('/blog/tags/sort/', '#Java-并发')" data-tippy-content="Java 并发">
                <button>Java 并发&nbsp;<span>0 / 1</span></button>
            </a>
        
    </div>

</tags>
                    <tags id="tags-main" class="hidden">
    

    
    
    

    
    

    <div>
        
            <a onclick="changePoint('/blog/tags/', '#Java-并发')" data-tippy-content="Java 并发">
                <button>Java 并发&nbsp;<span>0 / 1</span></button>
            </a>
        
    </div>

</tags>
                </ul>
                
            </div>
            
            
            
<ul id="markdown-toc">
  <li><a href="#手写死锁" id="markdown-toc-手写死锁">手写死锁</a></li>
  <li><a href="#手写生产者消费者模型" id="markdown-toc-手写生产者消费者模型">手写生产者消费者模型</a>    <ul>
      <li><a href="#1-使用-synchronized-和-waitnotifynotifyall-实现" id="markdown-toc-1-使用-synchronized-和-waitnotifynotifyall-实现">1. 使用 synchronized 和 wait/notify/notifyAll 实现</a></li>
      <li><a href="#2-使用-blockingqueue-实现" id="markdown-toc-2-使用-blockingqueue-实现">2. 使用 BlockingQueue 实现</a></li>
    </ul>
  </li>
  <li><a href="#三个线程顺序打印-abc" id="markdown-toc-三个线程顺序打印-abc">三个线程顺序打印 ABC</a>    <ul>
      <li><a href="#1-使用-join-实现" id="markdown-toc-1-使用-join-实现">1. 使用 join() 实现</a></li>
      <li><a href="#2-使用线程池的-executorservice-顺序执行" id="markdown-toc-2-使用线程池的-executorservice-顺序执行">2. 使用线程池的 ExecutorService 顺序执行</a></li>
      <li><a href="#3-使用-countdownlatch-实现" id="markdown-toc-3-使用-countdownlatch-实现">3. 使用 CountDownLatch 实现</a></li>
      <li><a href="#4-使用-synchronized-和-waitnotifynotifyall-实现" id="markdown-toc-4-使用-synchronized-和-waitnotifynotifyall-实现">4. 使用 synchronized 和 wait/notify/notifyAll 实现</a></li>
      <li><a href="#5-使用-reentrantlock-和-condition-实现" id="markdown-toc-5-使用-reentrantlock-和-condition-实现">5. 使用 ReentrantLock 和 Condition 实现</a></li>
    </ul>
  </li>
  <li><a href="#三个线程循环顺序打印-abc-十次" id="markdown-toc-三个线程循环顺序打印-abc-十次">三个线程循环顺序打印 ABC 十次</a>    <ul>
      <li><a href="#1-使用-synchronized-和-waitnotifynotifyall-实现-1" id="markdown-toc-1-使用-synchronized-和-waitnotifynotifyall-实现-1">1. 使用 synchronized 和 wait/notify/notifyAll 实现</a></li>
      <li><a href="#2-使用-reentrantlock-和-condition-实现" id="markdown-toc-2-使用-reentrantlock-和-condition-实现">2. 使用 ReentrantLock 和 Condition 实现</a></li>
    </ul>
  </li>
</ul>

<blockquote>
  <ul class="task-list">
    <li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" checked="checked" />手写死锁</li>
    <li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" checked="checked" />手写生产者消费者模型</li>
    <li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" checked="checked" />三个线程顺序打印 ABC</li>
    <li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" checked="checked" />三个线程循环顺序打印 ABC 十次</li>
  </ul>
</blockquote>

<h2 id="手写死锁">手写死锁</h2>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
</pre></td><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">DeadLockDemo</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="nc">Object</span> <span class="n">resource1</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Object</span><span class="o">();</span> <span class="c1">// 资源1</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="nc">Object</span> <span class="n">resource2</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Object</span><span class="o">();</span> <span class="c1">// 资源2</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">new</span> <span class="nf">Thread</span><span class="o">(()</span> <span class="o">-&gt;</span> <span class="o">{</span>
            <span class="kd">synchronized</span> <span class="o">(</span><span class="n">resource1</span><span class="o">)</span> <span class="o">{</span>
                <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="nc">Thread</span><span class="o">.</span><span class="na">currentThread</span><span class="o">().</span><span class="na">getName</span><span class="o">()</span> <span class="o">+</span> <span class="s">" 获取资源1"</span><span class="o">);</span>
                <span class="k">try</span> <span class="o">{</span>
                    <span class="nc">Thread</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="mi">100</span><span class="o">);</span>
                <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">InterruptedException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
                    <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
                <span class="o">}</span>
                <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="nc">Thread</span><span class="o">.</span><span class="na">currentThread</span><span class="o">().</span><span class="na">getName</span><span class="o">()</span> <span class="o">+</span> <span class="s">" 等待资源2"</span><span class="o">);</span>
                <span class="kd">synchronized</span> <span class="o">(</span><span class="n">resource2</span><span class="o">)</span> <span class="o">{</span>
                    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="nc">Thread</span><span class="o">.</span><span class="na">currentThread</span><span class="o">().</span><span class="na">getName</span><span class="o">()</span> <span class="o">+</span> <span class="s">" 获取资源2"</span><span class="o">);</span>
                <span class="o">}</span>
            <span class="o">}</span>
        <span class="o">},</span> <span class="s">"线程1"</span><span class="o">).</span><span class="na">start</span><span class="o">();</span>

        <span class="k">new</span> <span class="nf">Thread</span><span class="o">(()</span> <span class="o">-&gt;</span> <span class="o">{</span>
            <span class="kd">synchronized</span> <span class="o">(</span><span class="n">resource2</span><span class="o">)</span> <span class="o">{</span>
                <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="nc">Thread</span><span class="o">.</span><span class="na">currentThread</span><span class="o">().</span><span class="na">getName</span><span class="o">()</span> <span class="o">+</span> <span class="s">" 获取资源2"</span><span class="o">);</span>
                <span class="k">try</span> <span class="o">{</span>
                    <span class="nc">Thread</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="mi">100</span><span class="o">);</span>
                <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">InterruptedException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
                    <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
                <span class="o">}</span>
                <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="nc">Thread</span><span class="o">.</span><span class="na">currentThread</span><span class="o">().</span><span class="na">getName</span><span class="o">()</span> <span class="o">+</span> <span class="s">" 等待资源1"</span><span class="o">);</span>
                <span class="kd">synchronized</span> <span class="o">(</span><span class="n">resource1</span><span class="o">)</span> <span class="o">{</span>
                    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="nc">Thread</span><span class="o">.</span><span class="na">currentThread</span><span class="o">().</span><span class="na">getName</span><span class="o">()</span> <span class="o">+</span> <span class="s">" 获取资源1"</span><span class="o">);</span>
                <span class="o">}</span>
            <span class="o">}</span>
        <span class="o">},</span> <span class="s">"线程2"</span><span class="o">).</span><span class="na">start</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
</pre></td><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">DeadLockDemo</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">new</span> <span class="nf">DeadLockDemo</span><span class="o">().</span><span class="na">deadLock</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="kd">final</span> <span class="nc">String</span> <span class="no">A</span> <span class="o">=</span> <span class="s">"A"</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="nc">String</span> <span class="no">B</span> <span class="o">=</span> <span class="s">"b"</span><span class="o">;</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">deadLock</span><span class="o">()</span> <span class="o">{</span>
        <span class="nc">Thread</span> <span class="n">t1</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Thread</span><span class="o">(()</span> <span class="o">-&gt;</span> <span class="o">{</span>
            <span class="kd">synchronized</span> <span class="o">(</span><span class="no">A</span><span class="o">)</span> <span class="o">{</span>
                <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="nc">Thread</span><span class="o">.</span><span class="na">currentThread</span><span class="o">().</span><span class="na">getName</span><span class="o">()</span> <span class="o">+</span> <span class="s">" 线程获得了锁 A，尝试获取锁 B。"</span><span class="o">);</span>
                <span class="k">try</span> <span class="o">{</span>
                    <span class="nc">TimeUnit</span><span class="o">.</span><span class="na">SECONDS</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="mi">1</span><span class="o">);</span>
                <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">InterruptedException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
                    <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
                <span class="o">}</span>
                <span class="kd">synchronized</span> <span class="o">(</span><span class="no">B</span><span class="o">)</span> <span class="o">{</span>
                <span class="o">}</span>
            <span class="o">}</span>
        <span class="o">},</span> <span class="s">"t1"</span><span class="o">);</span>

        <span class="nc">Thread</span> <span class="n">t2</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Thread</span><span class="o">(()</span> <span class="o">-&gt;</span> <span class="o">{</span>
            <span class="kd">synchronized</span> <span class="o">(</span><span class="no">B</span><span class="o">)</span> <span class="o">{</span>
                <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="nc">Thread</span><span class="o">.</span><span class="na">currentThread</span><span class="o">().</span><span class="na">getName</span><span class="o">()</span> <span class="o">+</span> <span class="s">" 线程获得了锁 B，尝试获取锁 A。"</span><span class="o">);</span>
                <span class="kd">synchronized</span> <span class="o">(</span><span class="no">A</span><span class="o">)</span> <span class="o">{</span>

                <span class="o">}</span>
            <span class="o">}</span>
        <span class="o">},</span> <span class="s">"t2"</span><span class="o">);</span>

        <span class="n">t1</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>
        <span class="n">t2</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="手写生产者消费者模型">手写生产者消费者模型</h2>

<h3 id="1-使用-synchronized-和-waitnotifynotifyall-实现">1. 使用 synchronized 和 wait/notify/notifyAll 实现</h3>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
</pre></td><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">ProducerConsumerExample</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">Queue</span><span class="o">&lt;</span><span class="nc">Integer</span><span class="o">&gt;</span> <span class="n">queue</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">LinkedList</span><span class="o">&lt;&gt;();</span>
        <span class="kt">int</span> <span class="n">maxSize</span> <span class="o">=</span> <span class="mi">5</span><span class="o">;</span>

        <span class="nc">Thread</span> <span class="n">producer</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Thread</span><span class="o">(</span><span class="k">new</span> <span class="nc">Producer</span><span class="o">(</span><span class="n">queue</span><span class="o">,</span> <span class="n">maxSize</span><span class="o">),</span> <span class="s">"Producer"</span><span class="o">);</span>
        <span class="nc">Thread</span> <span class="n">consumer</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Thread</span><span class="o">(</span><span class="k">new</span> <span class="nc">Consumer</span><span class="o">(</span><span class="n">queue</span><span class="o">),</span> <span class="s">"Consumer"</span><span class="o">);</span>

        <span class="n">producer</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>
        <span class="n">consumer</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="kd">class</span> <span class="nc">Producer</span> <span class="kd">implements</span> <span class="nc">Runnable</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="nc">Queue</span><span class="o">&lt;</span><span class="nc">Integer</span><span class="o">&gt;</span> <span class="n">queue</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">maxSize</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nf">Producer</span><span class="o">(</span><span class="nc">Queue</span><span class="o">&lt;</span><span class="nc">Integer</span><span class="o">&gt;</span> <span class="n">queue</span><span class="o">,</span> <span class="kt">int</span> <span class="n">maxSize</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">queue</span> <span class="o">=</span> <span class="n">queue</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">maxSize</span> <span class="o">=</span> <span class="n">maxSize</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
        <span class="kt">int</span> <span class="n">value</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
        <span class="k">while</span> <span class="o">(</span><span class="kc">true</span><span class="o">)</span> <span class="o">{</span>
            <span class="kd">synchronized</span> <span class="o">(</span><span class="n">queue</span><span class="o">)</span> <span class="o">{</span>
                <span class="k">while</span> <span class="o">(</span><span class="n">queue</span><span class="o">.</span><span class="na">size</span><span class="o">()</span> <span class="o">==</span> <span class="n">maxSize</span><span class="o">)</span> <span class="o">{</span>
                    <span class="k">try</span> <span class="o">{</span>
                        <span class="n">queue</span><span class="o">.</span><span class="na">wait</span><span class="o">();</span>
                    <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">InterruptedException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
                        <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
                    <span class="o">}</span>
                <span class="o">}</span>
                <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Producing value: "</span> <span class="o">+</span> <span class="n">value</span><span class="o">);</span>
                <span class="n">queue</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">value</span><span class="o">++);</span>
                <span class="n">queue</span><span class="o">.</span><span class="na">notifyAll</span><span class="o">();</span>
            <span class="o">}</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="kd">class</span> <span class="nc">Consumer</span> <span class="kd">implements</span> <span class="nc">Runnable</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="nc">Queue</span><span class="o">&lt;</span><span class="nc">Integer</span><span class="o">&gt;</span> <span class="n">queue</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nf">Consumer</span><span class="o">(</span><span class="nc">Queue</span><span class="o">&lt;</span><span class="nc">Integer</span><span class="o">&gt;</span> <span class="n">queue</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">queue</span> <span class="o">=</span> <span class="n">queue</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">while</span> <span class="o">(</span><span class="kc">true</span><span class="o">)</span> <span class="o">{</span>
            <span class="kd">synchronized</span> <span class="o">(</span><span class="n">queue</span><span class="o">)</span> <span class="o">{</span>
                <span class="k">while</span> <span class="o">(</span><span class="n">queue</span><span class="o">.</span><span class="na">isEmpty</span><span class="o">())</span> <span class="o">{</span>
                    <span class="k">try</span> <span class="o">{</span>
                        <span class="n">queue</span><span class="o">.</span><span class="na">wait</span><span class="o">();</span>
                    <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">InterruptedException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
                        <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
                    <span class="o">}</span>
                <span class="o">}</span>
                <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Consuming value: "</span> <span class="o">+</span> <span class="n">queue</span><span class="o">.</span><span class="na">remove</span><span class="o">());</span>
                <span class="n">queue</span><span class="o">.</span><span class="na">notifyAll</span><span class="o">();</span>
            <span class="o">}</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="2-使用-blockingqueue-实现">2. 使用 BlockingQueue 实现</h3>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
</pre></td><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">ProducerConsumerExample</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">BlockingQueue</span><span class="o">&lt;</span><span class="nc">Integer</span><span class="o">&gt;</span> <span class="n">queue</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">LinkedBlockingQueue</span><span class="o">&lt;&gt;(</span><span class="mi">5</span><span class="o">);</span>

        <span class="nc">Thread</span> <span class="n">producer</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Thread</span><span class="o">(</span><span class="k">new</span> <span class="nc">Producer</span><span class="o">(</span><span class="n">queue</span><span class="o">),</span> <span class="s">"Producer"</span><span class="o">);</span>
        <span class="nc">Thread</span> <span class="n">consumer</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Thread</span><span class="o">(</span><span class="k">new</span> <span class="nc">Consumer</span><span class="o">(</span><span class="n">queue</span><span class="o">),</span> <span class="s">"Consumer"</span><span class="o">);</span>

        <span class="n">producer</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>
        <span class="n">consumer</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="kd">class</span> <span class="nc">Producer</span> <span class="kd">implements</span> <span class="nc">Runnable</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="nc">BlockingQueue</span><span class="o">&lt;</span><span class="nc">Integer</span><span class="o">&gt;</span> <span class="n">queue</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nf">Producer</span><span class="o">(</span><span class="nc">BlockingQueue</span><span class="o">&lt;</span><span class="nc">Integer</span><span class="o">&gt;</span> <span class="n">queue</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">queue</span> <span class="o">=</span> <span class="n">queue</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
        <span class="kt">int</span> <span class="n">value</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
        <span class="k">while</span> <span class="o">(</span><span class="kc">true</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">try</span> <span class="o">{</span>
                <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Producing value: "</span> <span class="o">+</span> <span class="n">value</span><span class="o">);</span>
                <span class="n">queue</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">value</span><span class="o">++);</span>
            <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">InterruptedException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
            <span class="o">}</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="kd">class</span> <span class="nc">Consumer</span> <span class="kd">implements</span> <span class="nc">Runnable</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="nc">BlockingQueue</span><span class="o">&lt;</span><span class="nc">Integer</span><span class="o">&gt;</span> <span class="n">queue</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nf">Consumer</span><span class="o">(</span><span class="nc">BlockingQueue</span><span class="o">&lt;</span><span class="nc">Integer</span><span class="o">&gt;</span> <span class="n">queue</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">queue</span> <span class="o">=</span> <span class="n">queue</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">while</span> <span class="o">(</span><span class="kc">true</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">try</span> <span class="o">{</span>
                <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Consuming value: "</span> <span class="o">+</span> <span class="n">queue</span><span class="o">.</span><span class="na">take</span><span class="o">());</span>
            <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">InterruptedException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
            <span class="o">}</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="三个线程顺序打印-abc">三个线程顺序打印 ABC</h2>

<h3 id="1-使用-join-实现">1. 使用 join() 实现</h3>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
</pre></td><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">OrderedPrintABC</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">Thread</span> <span class="n">t1</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Thread</span><span class="o">(()</span> <span class="o">-&gt;</span> <span class="o">{</span>
            <span class="k">try</span> <span class="o">{</span>
                <span class="nc">Thread</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="mi">500</span><span class="o">);</span>
            <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">InterruptedException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
            <span class="o">}</span>
            <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"A"</span><span class="o">);</span>
        <span class="o">});</span>

        <span class="nc">Thread</span> <span class="n">t2</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Thread</span><span class="o">(()</span> <span class="o">-&gt;</span> <span class="o">{</span>
            <span class="k">try</span> <span class="o">{</span>
                <span class="n">t1</span><span class="o">.</span><span class="na">join</span><span class="o">();</span>
                <span class="nc">Thread</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="mi">500</span><span class="o">);</span>
            <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">InterruptedException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
            <span class="o">}</span>
            <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"B"</span><span class="o">);</span>
        <span class="o">});</span>

        <span class="nc">Thread</span> <span class="n">t3</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Thread</span><span class="o">(()</span> <span class="o">-&gt;</span> <span class="o">{</span>
            <span class="k">try</span> <span class="o">{</span>
                <span class="n">t2</span><span class="o">.</span><span class="na">join</span><span class="o">();</span>
            <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">InterruptedException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
            <span class="o">}</span>
            <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"C"</span><span class="o">);</span>
        <span class="o">});</span>

        <span class="n">t1</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>
        <span class="n">t2</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>
        <span class="n">t3</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="2-使用线程池的-executorservice-顺序执行">2. 使用线程池的 ExecutorService 顺序执行</h3>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre></td><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">OrderedPrintABC</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">ExecutorService</span> <span class="n">executor</span> <span class="o">=</span> <span class="nc">Executors</span><span class="o">.</span><span class="na">newSingleThreadExecutor</span><span class="o">();</span>
        <span class="n">executor</span><span class="o">.</span><span class="na">execute</span><span class="o">(()</span> <span class="o">-&gt;</span> <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"A"</span><span class="o">));</span>
        <span class="n">executor</span><span class="o">.</span><span class="na">execute</span><span class="o">(()</span> <span class="o">-&gt;</span> <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"B"</span><span class="o">));</span>
        <span class="n">executor</span><span class="o">.</span><span class="na">execute</span><span class="o">(()</span> <span class="o">-&gt;</span> <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"C"</span><span class="o">));</span>
        <span class="n">executor</span><span class="o">.</span><span class="na">shutdown</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="3-使用-countdownlatch-实现">3. 使用 CountDownLatch 实现</h3>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
</pre></td><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">OrderedPrintABC</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">CountDownLatch</span> <span class="n">latch1</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">CountDownLatch</span><span class="o">(</span><span class="mi">1</span><span class="o">);</span>
        <span class="nc">CountDownLatch</span> <span class="n">latch2</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">CountDownLatch</span><span class="o">(</span><span class="mi">1</span><span class="o">);</span>

        <span class="nc">Thread</span> <span class="n">t1</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Thread</span><span class="o">(()</span> <span class="o">-&gt;</span> <span class="o">{</span>
            <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"A"</span><span class="o">);</span>
            <span class="n">latch1</span><span class="o">.</span><span class="na">countDown</span><span class="o">();</span>
        <span class="o">});</span>

        <span class="nc">Thread</span> <span class="n">t2</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Thread</span><span class="o">(()</span> <span class="o">-&gt;</span> <span class="o">{</span>
            <span class="k">try</span> <span class="o">{</span>
                <span class="n">latch1</span><span class="o">.</span><span class="na">await</span><span class="o">();</span>
                <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"B"</span><span class="o">);</span>
                <span class="n">latch2</span><span class="o">.</span><span class="na">countDown</span><span class="o">();</span>
            <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">InterruptedException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
            <span class="o">}</span>
        <span class="o">});</span>

        <span class="nc">Thread</span> <span class="n">t3</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Thread</span><span class="o">(()</span> <span class="o">-&gt;</span> <span class="o">{</span>
            <span class="k">try</span> <span class="o">{</span>
                <span class="n">latch2</span><span class="o">.</span><span class="na">await</span><span class="o">();</span>
                <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"C"</span><span class="o">);</span>
            <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">InterruptedException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
            <span class="o">}</span>
        <span class="o">});</span>

        <span class="n">t1</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>
        <span class="n">t2</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>
        <span class="n">t3</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="4-使用-synchronized-和-waitnotifynotifyall-实现">4. 使用 synchronized 和 wait/notify/notifyAll 实现</h3>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
</pre></td><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">OrderedPrintABC</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="nc">Object</span> <span class="n">lock</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Object</span><span class="o">();</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kt">int</span> <span class="n">state</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">Thread</span> <span class="n">t1</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Thread</span><span class="o">(()</span> <span class="o">-&gt;</span> <span class="o">{</span>
            <span class="kd">synchronized</span> <span class="o">(</span><span class="n">lock</span><span class="o">)</span> <span class="o">{</span>
                <span class="k">while</span> <span class="o">(</span><span class="n">state</span> <span class="o">%</span> <span class="mi">3</span> <span class="o">!=</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
                    <span class="k">try</span> <span class="o">{</span>
                        <span class="n">lock</span><span class="o">.</span><span class="na">wait</span><span class="o">();</span>
                    <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">InterruptedException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
                        <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
                    <span class="o">}</span>
                <span class="o">}</span>
                <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"A"</span><span class="o">);</span>
                <span class="n">state</span><span class="o">++;</span>
                <span class="n">lock</span><span class="o">.</span><span class="na">notifyAll</span><span class="o">();</span>
            <span class="o">}</span>
        <span class="o">});</span>

        <span class="nc">Thread</span> <span class="n">t2</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Thread</span><span class="o">(()</span> <span class="o">-&gt;</span> <span class="o">{</span>
            <span class="kd">synchronized</span> <span class="o">(</span><span class="n">lock</span><span class="o">)</span> <span class="o">{</span>
                <span class="k">while</span> <span class="o">(</span><span class="n">state</span> <span class="o">%</span> <span class="mi">3</span> <span class="o">!=</span> <span class="mi">1</span><span class="o">)</span> <span class="o">{</span>
                    <span class="k">try</span> <span class="o">{</span>
                        <span class="n">lock</span><span class="o">.</span><span class="na">wait</span><span class="o">();</span>
                    <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">InterruptedException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
                        <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
                    <span class="o">}</span>
                <span class="o">}</span>
                <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"B"</span><span class="o">);</span>
                <span class="n">state</span><span class="o">++;</span>
                <span class="n">lock</span><span class="o">.</span><span class="na">notifyAll</span><span class="o">();</span>
            <span class="o">}</span>
        <span class="o">});</span>

        <span class="nc">Thread</span> <span class="n">t3</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Thread</span><span class="o">(()</span> <span class="o">-&gt;</span> <span class="o">{</span>
            <span class="kd">synchronized</span> <span class="o">(</span><span class="n">lock</span><span class="o">)</span> <span class="o">{</span>
                <span class="k">while</span> <span class="o">(</span><span class="n">state</span> <span class="o">%</span> <span class="mi">3</span> <span class="o">!=</span> <span class="mi">2</span><span class="o">)</span> <span class="o">{</span>
                    <span class="k">try</span> <span class="o">{</span>
                        <span class="n">lock</span><span class="o">.</span><span class="na">wait</span><span class="o">();</span>
                    <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">InterruptedException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
                        <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
                    <span class="o">}</span>
                <span class="o">}</span>
                <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"C"</span><span class="o">);</span>
                <span class="n">state</span><span class="o">++;</span>
                <span class="n">lock</span><span class="o">.</span><span class="na">notifyAll</span><span class="o">();</span>
            <span class="o">}</span>
        <span class="o">});</span>

        <span class="n">t1</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>
        <span class="n">t2</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>
        <span class="n">t3</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="5-使用-reentrantlock-和-condition-实现">5. 使用 ReentrantLock 和 Condition 实现</h3>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
</pre></td><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">OrderedPrintABC</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="nc">ReentrantLock</span> <span class="n">lock</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ReentrantLock</span><span class="o">();</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="nc">Condition</span> <span class="n">condition</span> <span class="o">=</span> <span class="n">lock</span><span class="o">.</span><span class="na">newCondition</span><span class="o">();</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kt">int</span> <span class="n">state</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">Thread</span> <span class="n">t1</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Thread</span><span class="o">(()</span> <span class="o">-&gt;</span> <span class="o">{</span>
            <span class="n">lock</span><span class="o">.</span><span class="na">lock</span><span class="o">();</span>
            <span class="k">try</span> <span class="o">{</span>
                <span class="k">while</span> <span class="o">(</span><span class="n">state</span> <span class="o">%</span> <span class="mi">3</span> <span class="o">!=</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
                    <span class="k">try</span> <span class="o">{</span>
                        <span class="n">condition</span><span class="o">.</span><span class="na">await</span><span class="o">();</span>
                    <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">InterruptedException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
                        <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
                    <span class="o">}</span>
                <span class="o">}</span>
                <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"A"</span><span class="o">);</span>
                <span class="n">state</span><span class="o">++;</span>
                <span class="n">condition</span><span class="o">.</span><span class="na">signalAll</span><span class="o">();</span>
            <span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
                <span class="n">lock</span><span class="o">.</span><span class="na">unlock</span><span class="o">();</span>
            <span class="o">}</span>
        <span class="o">});</span>

        <span class="nc">Thread</span> <span class="n">t2</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Thread</span><span class="o">(()</span> <span class="o">-&gt;</span> <span class="o">{</span>
            <span class="n">lock</span><span class="o">.</span><span class="na">lock</span><span class="o">();</span>
            <span class="k">try</span> <span class="o">{</span>
                <span class="k">while</span> <span class="o">(</span><span class="n">state</span> <span class="o">%</span> <span class="mi">3</span> <span class="o">!=</span> <span class="mi">1</span><span class="o">)</span> <span class="o">{</span>
                    <span class="k">try</span> <span class="o">{</span>
                        <span class="n">condition</span><span class="o">.</span><span class="na">await</span><span class="o">();</span>
                    <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">InterruptedException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
                        <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
                    <span class="o">}</span>
                <span class="o">}</span>
                <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"B"</span><span class="o">);</span>
                <span class="n">state</span><span class="o">++;</span>
                <span class="n">condition</span><span class="o">.</span><span class="na">signalAll</span><span class="o">();</span>
            <span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
                <span class="n">lock</span><span class="o">.</span><span class="na">unlock</span><span class="o">();</span>
            <span class="o">}</span>
        <span class="o">});</span>

        <span class="nc">Thread</span> <span class="n">t3</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Thread</span><span class="o">(()</span> <span class="o">-&gt;</span> <span class="o">{</span>
            <span class="n">lock</span><span class="o">.</span><span class="na">lock</span><span class="o">();</span>
            <span class="k">try</span> <span class="o">{</span>
                <span class="k">while</span> <span class="o">(</span><span class="n">state</span> <span class="o">%</span> <span class="mi">3</span> <span class="o">!=</span> <span class="mi">2</span><span class="o">)</span> <span class="o">{</span>
                    <span class="k">try</span> <span class="o">{</span>
                        <span class="n">condition</span><span class="o">.</span><span class="na">await</span><span class="o">();</span>
                    <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">InterruptedException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
                        <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
                    <span class="o">}</span>
                <span class="o">}</span>
                <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"C"</span><span class="o">);</span>
                <span class="n">state</span><span class="o">++;</span>
                <span class="n">condition</span><span class="o">.</span><span class="na">signalAll</span><span class="o">();</span>
            <span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
                <span class="n">lock</span><span class="o">.</span><span class="na">unlock</span><span class="o">();</span>
            <span class="o">}</span>
        <span class="o">});</span>

        <span class="n">t1</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>
        <span class="n">t2</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>
        <span class="n">t3</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="三个线程循环顺序打印-abc-十次">三个线程循环顺序打印 ABC 十次</h2>

<h3 id="1-使用-synchronized-和-waitnotifynotifyall-实现-1">1. 使用 synchronized 和 wait/notify/notifyAll 实现</h3>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
</pre></td><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">PrintABC</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">int</span> <span class="no">PRINT_COUNT</span> <span class="o">=</span> <span class="mi">10</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">int</span> <span class="no">THREAD_COUNT</span> <span class="o">=</span> <span class="mi">3</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">volatile</span> <span class="kt">int</span> <span class="n">currentCount</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">Object</span> <span class="n">lock</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Object</span><span class="o">();</span>
        <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="no">THREAD_COUNT</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
            <span class="k">new</span> <span class="nf">Thread</span><span class="o">(</span><span class="k">new</span> <span class="nc">PrintTask</span><span class="o">(</span><span class="n">lock</span><span class="o">,</span> <span class="n">i</span><span class="o">),</span> <span class="nc">String</span><span class="o">.</span><span class="na">valueOf</span><span class="o">((</span><span class="kt">char</span><span class="o">)</span> <span class="o">(</span><span class="sc">'A'</span> <span class="o">+</span> <span class="n">i</span><span class="o">))).</span><span class="na">start</span><span class="o">();</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">PrintTask</span> <span class="kd">implements</span> <span class="nc">Runnable</span> <span class="o">{</span>
        <span class="kd">private</span> <span class="kd">final</span> <span class="nc">Object</span> <span class="n">lock</span><span class="o">;</span>
        <span class="kd">private</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">targetNum</span><span class="o">;</span>

        <span class="kd">public</span> <span class="nf">PrintTask</span><span class="o">(</span><span class="nc">Object</span> <span class="n">lock</span><span class="o">,</span> <span class="kt">int</span> <span class="n">targetNum</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">this</span><span class="o">.</span><span class="na">lock</span> <span class="o">=</span> <span class="n">lock</span><span class="o">;</span>
            <span class="k">this</span><span class="o">.</span><span class="na">targetNum</span> <span class="o">=</span> <span class="n">targetNum</span><span class="o">;</span>
        <span class="o">}</span>

        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
            <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="no">PRINT_COUNT</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
                <span class="kd">synchronized</span> <span class="o">(</span><span class="n">lock</span><span class="o">)</span> <span class="o">{</span>
                    <span class="k">while</span> <span class="o">(</span><span class="n">currentCount</span> <span class="o">%</span> <span class="no">THREAD_COUNT</span> <span class="o">!=</span> <span class="n">targetNum</span><span class="o">)</span> <span class="o">{</span>
                        <span class="k">try</span> <span class="o">{</span>
                            <span class="n">lock</span><span class="o">.</span><span class="na">wait</span><span class="o">();</span>
                        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">InterruptedException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
                            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
                        <span class="o">}</span>
                    <span class="o">}</span>
                    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="nc">Thread</span><span class="o">.</span><span class="na">currentThread</span><span class="o">().</span><span class="na">getName</span><span class="o">());</span>
                    <span class="n">currentCount</span><span class="o">++;</span>
                    <span class="n">lock</span><span class="o">.</span><span class="na">notifyAll</span><span class="o">();</span>
                <span class="o">}</span>
            <span class="o">}</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="2-使用-reentrantlock-和-condition-实现">2. 使用 ReentrantLock 和 Condition 实现</h3>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
</pre></td><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">PrintABC</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kt">int</span> <span class="n">threadCount</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kt">int</span> <span class="n">printCount</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kt">int</span> <span class="n">currentCount</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="nc">Lock</span> <span class="n">lock</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ReentrantLock</span><span class="o">();</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="nc">Condition</span><span class="o">[]</span> <span class="n">conditions</span><span class="o">;</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">threadCount</span> <span class="o">=</span> <span class="mi">3</span><span class="o">;</span>
        <span class="n">printCount</span> <span class="o">=</span> <span class="mi">10</span><span class="o">;</span>
        <span class="n">conditions</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Condition</span><span class="o">[</span><span class="n">threadCount</span><span class="o">];</span>

        <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">threadCount</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
            <span class="n">conditions</span><span class="o">[</span><span class="n">i</span><span class="o">]</span> <span class="o">=</span> <span class="n">lock</span><span class="o">.</span><span class="na">newCondition</span><span class="o">();</span>
        <span class="o">}</span>

        <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">threadCount</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
            <span class="k">new</span> <span class="nf">Thread</span><span class="o">(</span><span class="k">new</span> <span class="nc">PrintTask</span><span class="o">(</span><span class="n">i</span><span class="o">),</span> <span class="nc">String</span><span class="o">.</span><span class="na">valueOf</span><span class="o">((</span><span class="kt">char</span><span class="o">)</span> <span class="o">(</span><span class="sc">'A'</span> <span class="o">+</span> <span class="n">i</span><span class="o">))).</span><span class="na">start</span><span class="o">();</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="kd">static</span> <span class="kd">class</span> <span class="nc">PrintTask</span> <span class="kd">implements</span> <span class="nc">Runnable</span> <span class="o">{</span>
        <span class="kd">private</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">threadIndex</span><span class="o">;</span>

        <span class="kd">public</span> <span class="nf">PrintTask</span><span class="o">(</span><span class="kt">int</span> <span class="n">threadIndex</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">this</span><span class="o">.</span><span class="na">threadIndex</span> <span class="o">=</span> <span class="n">threadIndex</span><span class="o">;</span>
        <span class="o">}</span>

        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
            <span class="k">while</span> <span class="o">(</span><span class="kc">true</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">lock</span><span class="o">.</span><span class="na">lock</span><span class="o">();</span>
                <span class="k">try</span> <span class="o">{</span>
                    <span class="k">if</span> <span class="o">(</span><span class="n">currentCount</span> <span class="o">&gt;=</span> <span class="n">threadCount</span> <span class="o">*</span> <span class="n">printCount</span><span class="o">)</span> <span class="o">{</span>
                        <span class="k">break</span><span class="o">;</span>
                    <span class="o">}</span>
                    <span class="k">while</span> <span class="o">(</span><span class="n">currentCount</span> <span class="o">%</span> <span class="n">threadCount</span> <span class="o">!=</span> <span class="n">threadIndex</span><span class="o">)</span> <span class="o">{</span>
                        <span class="n">conditions</span><span class="o">[</span><span class="n">threadIndex</span><span class="o">].</span><span class="na">await</span><span class="o">();</span>
                    <span class="o">}</span>
                    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="nc">Thread</span><span class="o">.</span><span class="na">currentThread</span><span class="o">().</span><span class="na">getName</span><span class="o">());</span>
                    <span class="n">currentCount</span><span class="o">++;</span>
                    <span class="n">conditions</span><span class="o">[(</span><span class="n">threadIndex</span> <span class="o">+</span> <span class="mi">1</span><span class="o">)</span> <span class="o">%</span> <span class="n">threadCount</span><span class="o">].</span><span class="na">signal</span><span class="o">();</span>
                <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">InterruptedException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
                    <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
                <span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
                    <span class="n">lock</span><span class="o">.</span><span class="na">unlock</span><span class="o">();</span>
                <span class="o">}</span>
            <span class="o">}</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

            <footer class="unit-foot">
                <div class="unit-inner">
                    <p>
                        <a class="go-top" data-tippy-content="Back to Top"><i class="fas fa-arrow-up"></i></a>
                    </p>
                    <nav class="pagination">
                        <div class="prev">
                            <span class="line line-top"></span>
                            <span class="line line-right"></span>
                            <span class="line line-bottom"></span>
                            <span class="line line-left"></span>
                            <a class="internal" data-tippy-content="LeetCode 232. 用栈实现队列" href="/blog/2023/06263683" rel="prev">🔥 上一篇</a>
                        </div>
                        
                        <div class="next">
                            <span class="line line-top"></span>
                            <span class="line line-right"></span>
                            <span class="line line-bottom"></span>
                            <span class="line line-left"></span>
                            <a class="internal" data-tippy-content="LeetCode 503. 下一个更大元素 II" href="/blog/2023/18328478" rel="next">下一篇 🔥</a>
                        </div>
                        
                    </nav>
                </div>
            </footer>
            <div class="post-copyright">
                <div class="post-copyright-author"><span class="post-copyright-meta">本文作者: </span>
                    <a href="/blog/" rel="author">
                        HGNULB
                    </a>
                </div>
                <div class="post-copyright-type"><span class="post-copyright-meta">本文链接: </span>
                    <a href="https://hgnulb.github.io/blog/2023/59592867">https://hgnulb.github.io/blog/2023/59592867</a>
                </div>
                
                <div class="post-copyright-notice"><span class="post-copyright-meta">版权声明: </span>
                    本博客所有文章除特别声明外，均采用
                    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" rel="license" target="_blank"> CC BY-NC-SA 4.0 </a>
                    许可协议，转载请注明出处！
                </div>
                
            </div>
        </div>
    </div>
</article>
<script>
    typedEntryTitle();
    const urlParams = new URLSearchParams(window.location.search);
    const type = urlParams.get("type");
    if (type === "sort") {
        const categoriesSort = document.getElementById("categories-sort");
        categoriesSort.classList.remove("hidden");
        const tagsSort = document.getElementById("tags-sort");
        tagsSort.classList.remove("hidden");
    } else {
        const categoriesMain = document.getElementById("categories-main");
        categoriesMain.classList.remove("hidden");
        const tagsMain = document.getElementById("tags-main");
        tagsMain.classList.remove("hidden");
    }
</script>
                <!--page end-->

            </div>
        </div>
    </div>
    <footer class="the-footer">
    <div class="unit-inner">
        <h4><a href="/blog/">About</a></h4>
        <p>Copyright ©2017-2025 走在修行的大街上 All rights reserved</p>
        <p id="sitetime"></p>
        
        <p>
            <span id="busuanzi_container_page_pv">本文阅读量&nbsp;<span id="busuanzi_value_page_pv"></span>&nbsp;次</span>
            <span id="busuanzi_container_site_pv">本站访问量&nbsp;<span id="busuanzi_value_site_pv"></span>&nbsp;次</span>
            <span id="busuanzi_container_site_uv">本站访客数&nbsp;<span id="busuanzi_value_site_uv"></span>&nbsp;人</span>
        </p>
        
    </div>
    <div class="social-links">
        <a class="ico-gmail" data-tippy-content="email" href="mailto:lbjoyx@163.com" rel="me" target="_blank"></a>
        <a class="ico-leetcode" data-tippy-content="leetcode" href="https://leetcode.cn/u/hgnulb/" rel="me" target="_blank"></a>
        <a class="ico-github" data-tippy-content="github" href="https://github.com/hgnulb/" rel="me" target="_blank"></a>
        <a class="ico-douban" data-tippy-content="douban" href="https://book.douban.com/people/257597606/" rel="me" target="_blank"></a>
        <a class="ico-stackoverflow" data-tippy-content="stackoverflow" href="https://stackoverflow.com/users/10383025/" rel="me" target="_blank"></a>
        <a class="ico-nowcoder" data-tippy-content="nowcoder" href="https://www.nowcoder.com/profile/8667211/" rel="me" target="_blank"></a>
    </div>
    <button class="back-to-top"><i class="fas fa-arrow-alt-circle-up fa-3x"></i></button>
</footer>
</div>


<!--图片懒加载插件-->

<script src="https://cdn.jsdelivr.net/npm/jquery-lazyload/jquery.lazyload.min.js"></script>

<!--其他插件-->
<script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search/dest/simple-jekyll-search.min.js"></script>
<script src="https://cdn.jsdelivr.net/gh/hgnulb/blog@gh-pages/assets/libs/javascripts/canvas-bg.js"></script>

<script>
    let pathPrefix = "/blog";
    if ("true" === "true") {
        pathPrefix = "https://cdn.jsdelivr.net/gh/hgnulb/blog@gh-pages";
    }

    let pygmentsThemes = JSON.parse(`["fruity","zenburn","stata-dark","lightbulb"]`);

    function loadRandomPygmentsTheme() {
        const randomTheme = pygmentsThemes[Math.floor(Math.random() * pygmentsThemes.length)];
        const link = document.createElement("link");
        link.rel = "stylesheet";
        link.href = `${pathPrefix}/assets/libs/pygments_css/${randomTheme}.css`;
        document.head.appendChild(link);
    }

    function overrideCheckbox() {
        $(`input[type="checkbox"]`).each(function () {
            if (this.checked) {
                $(this).after(`<i class="fa-regular fa-square-check checkbox-icon checkbox-checked fa-lg"></i>`);
            } else {
                $(this).after(`<i class="fa-regular fa-square checkbox-icon fa-lg"></i>`);
            }
        });
    }

    function headerToggle() {
        let header = $("h1, h2, h3");
        header.filter(":not(.entry-title)").prepend(`<i class="title-icon fa-solid fa-caret-down" style="display: none;"></i>`);
        header.filter(":not(.entry-title)").mouseenter(function () {
            let titleIconChildren = $(this).find(".title-icon");
            if (titleIconChildren.is(".title-icon.fa-caret-down")) {
                titleIconChildren.attr("style", "display: inline-block;");
            }
        }).mouseleave(function () {
            let titleIconChildren = $(this).find(".title-icon");
            if (titleIconChildren.is(".title-icon.fa-caret-down")) {
                titleIconChildren.attr("style", "display: none;");
            }
        });
        $(".title-icon").on("click", function () {
            let click = $(this).data("clicks");
            if (click) {
                $(this).parent().nextUntil(this.parentNode.tagName).slideDown();
                $(this).removeClass("fa-caret-right").addClass("fa-caret-down");
                $(this).parent().nextUntil(this.parentNode.tagName).find(".title-icon").removeClass("fa-caret-right").addClass("fa-caret-down").attr("style", "display: none;");
                $(this).parent().nextUntil(this.parentNode.tagName).find(".title-icon").data("clicks", !click);
            } else {
                $(this).parent().nextUntil(this.parentNode.tagName).slideUp();
                $(this).removeClass("fa-caret-down").addClass("fa-caret-right");
            }
            $(this).data("clicks", !click);
        });
    }

    function lazyload() {
        if ("true" !== "true") {
            return;
        }
        $("img.lazyload").show().lazyload({
            event: "scroll",
            effect: "fadeIn"
        });
        $(window).bind("load", function () {
            setTimeout(function () {
                $("img.lazyload").trigger("scroll");
            }, 1000);
        });
    }

    function imgBoxFactory(imageUrl, imageName) {
        return `<div class="img-box"><img src=${imageUrl} alt=${imageName}></div>`;
    }

    function goTop() {
        let offset = 50, duration = 500, width = 960;
        $(window).scroll(function () {
            if ($(window).width() > width) {
                if ($(this).scrollTop() > offset) {
                    $("footer").css("top", "20px");
                    $("footer .back-to-top").fadeIn(duration);
                } else {
                    $("footer").css("top", "auto");
                    $("footer .back-to-top").fadeOut(duration);
                }
            }
        });
        $(window).resize(function () {
            if ($(window).width() < width) {
                $("footer").css("top", "auto");
                $("footer .back-to-top").fadeOut(duration);
            }
            if ($(window).width() >= width && $(this).scrollTop() > offset) {
                $("footer").css("top", "20px");
                $("footer .back-to-top").fadeIn(duration);
            }
        });
        $("footer .back-to-top, .go-top").on("click", function (event) {
            event.preventDefault();
            $("html, body").animate({
                scrollTop: 0
            }, duration);
            return false;
        });
    }

    function displayDetail() {
        let showHidden = $(".show-hidden");
        showHidden.each(function () {
            if ($(this).parent().next()) {
                $(this).parent().next().addClass("hidden");
            }
        });
        showHidden.on("click", function () {
            $(this).parent().next().slideToggle();
        });
    }

    function closeOverlay() {
        $(".nav-wrapper, .search-wrapper").removeAttr("style");
        $(".nav-form, .search-form").removeClass("active");
        $(".search-form").find("input").val("");
        $("body").removeClass("nav-overlay search-overlay");
    }

    function searchMethod() {
        $(".nav-global .btn-search").on("click", function () {
            $(".search-wrapper").css({display: "block"});
            let searchForm = $(".search-form");
            searchForm.addClass("active");
            searchForm.find("input").focus();
            $("body").addClass("search-overlay");
        });

        $(".nav-global .btn-menu").on("click", function () {
            $(".nav-wrapper").css({display: "block"});
            $(".nav-form").addClass("active");
            $(".nav-form #search-input").prop("disabled", true);
            $("body").addClass("nav-overlay");
        });

        $(".nav-wrapper .btn-close, .search-wrapper .btn-close").on("click", function () {
            closeOverlay();
        });

        new SimpleJekyllSearch({
            searchInput: document.getElementById("search-input"),
            resultsContainer: document.getElementById("results-container"),
            json: "/blog/home/search.json",
            searchResultTemplate: `<li><a href="{url}">{title}<time class="entry-date">{date}</time></a></li>`,
            noResultsText: "<p><b>Not Found</b></p>",
            limit: 15,
            fuzzy: true
        });
    }

    function pad(n) {
        return (n < 10) ? ("0" + n) : n;
    }

    function siteTime() {
        window.setTimeout("siteTime()", 1000);
        let seconds = 1000;
        let minutes = seconds * 60;
        let hours = minutes * 60;
        let days = hours * 24;
        let years = days * 365;
        let today = new Date();
        let startDate = new Date("2017/12/26");
        let diff = today - startDate;
        let diffYears = Math.floor(diff / years);
        let diffDays = Math.floor((diff / days) - diffYears * 365);
        let diffHours = Math.floor((diff - (diffYears * 365 + diffDays) * days) / hours);
        let diffMinutes = Math.floor((diff - (diffYears * 365 + diffDays) * days - diffHours * hours) / minutes);
        let diffSeconds = Math.floor((diff - (diffYears * 365 + diffDays) * days - diffHours * hours - diffMinutes * minutes) / seconds);
        document.getElementById("sitetime").innerHTML = "本博客已稳定运行 " + diffYears + " 年 " + diffDays + " 天 " + diffHours + " 小时 " + diffMinutes + " 分钟 " + pad(diffSeconds) + " 秒";
    }

    $(function () {
        lazyload();
        loadRandomPygmentsTheme();
        goTop();
        overrideCheckbox();
        headerToggle();
        displayDetail();
        searchMethod();
        siteTime();
    });
</script>
</body>
</html>